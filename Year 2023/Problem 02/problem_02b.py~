import re
import functools as ft

bag = {"red": 12, "green": 13, "blue": 14}

pattern = "Game (\d+): (.+)$"
cubes_re = "(\d+ green|\d+ red|\d+ blue)"


filename = "input.txt"
with open(filename) as games_file:
    acc = 0
    for game in games_file:
        m = re.match(pattern, game)
        if bool(m):
            arr = m.group(2).split(";")
            flag = True
            bag_max = {"red": 0, "green": 0, "blue": 0}
            for turn in arr:
                cubes_dict = {}
                for cubes in re.findall(cubes_re, turn):
                    value, color = re.match("(\d+) ([a-z]+)", cubes).groups()
                    cubes_dict[color] = int(value)
                    if cubes_dict[color] > bag_max[color]:
                        bag_max[color] = cubes_dict[color]
            acc += ft.reduce(lambda x, y: x * y, bag_max.values(), 1)
print(acc)
